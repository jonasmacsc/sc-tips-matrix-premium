<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SC Tips â€¢ Vem e VÃª SC â€” Matrix Premium</title>
<link rel="icon" type="image/png" href="assets/favicon.png">
<link rel="icon" type="image/gif" href="assets/favicon.gif">
<meta name="theme-color" content="#00ff66">
<style>
:root{
  --bg:#000;--panel:#0a0f14;--card:#0d1b12;--txt:#e8fff0;--muted:#b7d9c4;
  --gold:#ffd76a;--green:#22ff88;--red:#ff4d57;--line:#123a22;--chip:#0c2014;
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:radial-gradient(1200px 600px at 20% 0%, #031203 0%, #000 60%);color:var(--txt);font:15px/1.55 system-ui,Segoe UI,Roboto,Arial}
.wrap{max-width:1080px;margin:0 auto;padding:18px}
h1{margin:0 0 14px;display:flex;align-items:center;gap:10px}
h1 b{color:var(--gold)}
.card{background:linear-gradient(180deg,#0d1b12,#07110b);border:1px solid var(--line);border-radius:18px;padding:16px;margin:12px 0;box-shadow:0 10px 26px rgba(0,0,0,.5)}
select,input,button{border-radius:12px;border:1px solid var(--line);background:#0e1d15;color:var(--txt);padding:10px}
button{cursor:pointer;font-weight:600}
.pill{display:inline-flex;gap:6px;align-items:center;background:#0c2014;border:1px solid var(--line);border-radius:999px;padding:6px 10px;margin:4px 6px 0 0}
.ok{color:var(--green)} .err{color:var(--red)}
.grid{display:grid;grid-template-columns:repeat(9,1fr);gap:8px}
.num{height:46px;display:flex;align-items:center;justify-content:center;border-radius:10px;font-weight:700;border:1px solid #0005;position:relative}
.zero{background:#0a3c12} .red{background:#6b0f17} .black{background:#0f0f13}
.num.hl{box-shadow:0 0 0 2px #fff6 inset,0 0 18px rgba(34,255,136,.55)}
.num.sug{outline:2px solid var(--green);box-shadow:0 0 14px rgba(34,255,136,.45)}
.progress{height:10px;background:#0e1510;border:1px solid var(--line);border-radius:999px;overflow:hidden}
.progress>span{display:block;height:100%;width:0;background:linear-gradient(90deg,#22ff88,#46ffa6)}
.small{font-size:12px;color:var(--muted)}
.header{display:grid;grid-template-columns:1.3fr 1fr .8fr;gap:10px}
.row{display:grid;grid-template-columns:1fr 120px 120px 1fr;gap:10px}
.kv{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.badge{position:absolute;top:4px;right:6px;font-size:10px;background:#142a1a;color:#aaf8cc;border-radius:6px;padding:1px 6px}
</style>
</head>
<body>
<div class="wrap">
  <h1>ðŸŒ€ <b>SC Tips â€¢ Vem e VÃª SC</b> â€” Matrix Premium</h1>

  <!-- CabeÃ§alho/controles -->
  <div class="card">
    <div class="header">
      <label>EstratÃ©gia
        <select id="estrategia">
          <!-- lista igual ao print -->
          <option>Fire Precision</option>
          <option>CaÃ§ador de RepetiÃ§Ãµes</option>
          <option>Vizinho 1</option>
          <option>Vizinho 2</option>
          <option>Vizinho 3</option>
          <option>Terminais v4</option>
          <option>Terminais Secretos</option>
          <option>Terminais Duplos</option>
          <option>Terminais dos Finais</option>
          <option>Terminais Progressivos</option>
          <option>Tiro Seco</option>
          <option>FÃ³rmula 5X</option>
          <option>Alpha 6</option>
          <option>Linha dos Finais</option>
          <option>Quarta DimensÃ£o</option>
          <option>Pattern Breaker</option>
          <option>Cavalo SC Premium</option>
          <option>Cavalo 147</option>
          <option>Cavalo 258</option>
          <option>Cavalo 369</option>
          <option>Sector Target</option>
          <option>IA Top 5</option>
          <option>IA Secret Pattern</option>
        </select>
      </label>

      <label>AutoSend
        <select id="autosend">
          <option value="true">Ativo</option>
          <option value="false">Desligado</option>
        </select>
      </label>

      <label>MinConf (%)
        <input id="minconf" type="number" min="0" max="100" value="85">
      </label>
    </div>

    <div class="row" style="margin-top:10px">
      <input id="srcUrl" placeholder="Cole a URL WS (wss://) ou HTTP (https://) da mesa (Evolution/Pragmatic)">
      <button id="btnConnect">ðŸ”Œ Conectar</button>
      <button id="btnTG">Enviar TG</button>
      <label class="pill small"><input type="checkbox" id="init"> % Init</label>
    </div>

    <div class="kv">
      <span class="pill">Status: <b id="netStatus" class="err">Desconectado</b></span>
      <span class="pill">Modo: <b id="netMode">â€”</b></span>
      <span class="pill">Ãšltimo NÂº: <b id="ultimo">-</b></span>
      <span class="pill">Cooldown: <b id="cool">18s</b></span>
    </div>

    <div class="progress" style="margin-top:8px"><span id="bar"></span></div>
  </div>

  <!-- TABULEIRO -->
  <div class="card">
    <div class="grid" id="grid"></div>
    <div class="small" id="caption" style="margin-top:8px">Ãšltimo: â€” â€¢ ConfianÃ§a: â€” â€¢ Top5: â€”</div>
  </div>

  <!-- LOGS -->
  <div class="card">
    <h3 style="margin:0 0 8px">ðŸ“œ Logs</h3>
    <div class="small">Fonte: Evolution/Pragmatic â€¢ Atualiza a cada 3s â€¢ Fallback: casinoscores via proxy</div>
    <pre id="log" style="margin:8px 0 0;max-height:240px;overflow:auto;background:#0a0f1a;border:1px solid #063;border-radius:12px;padding:12px;color:#b7d9c4;white-space:pre-wrap">[Console pronto]\n</pre>
  </div>
</div>

<script>
/* ===== Helpers / UI ===== */
const $=s=>document.querySelector(s);
const logEl=$("#log"), cap=$("#caption"), bar=$("#bar");
const ultimoEl=$("#ultimo"), netStatus=$("#netStatus"), netMode=$("#netMode");
const grid=$("#grid");
const redSet=new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
const blackSet=new Set([2,4,6,8,10,11,13,15,17,20,22,24,26,28,29,31,33,35]);
function log(m){ const ts=new Date().toLocaleTimeString(); logEl.textContent+=`[${ts}] ${m}\n`; logEl.scrollTop=logEl.scrollHeight; }
function setStatus(t,ok=false){ netStatus.textContent=t; netStatus.classList.toggle("ok",ok); netStatus.classList.toggle("err",!ok); }
function flash(p){ bar.style.width=Math.max(0,Math.min(100,p))+"%"; }
function buildGrid(){ grid.innerHTML=""; for(let n=0;n<=36;n++){ const d=document.createElement("div"); d.className="num "+(n===0?"zero":(redSet.has(n)?"red":"black")); d.dataset.n=n; d.textContent=n; grid.appendChild(d);} }
function paint(high,sugSet){ document.querySelectorAll(".num").forEach(el=>{ el.classList.remove("hl","sug"); const n=+el.dataset.n; if(n===high) el.classList.add("hl"); if(sugSet&&sugSet.has(n)) el.classList.add("sug"); }); }
buildGrid();

/* ===== Timer 18s ===== */
let cd=18; setInterval(()=>{ $("#cool").textContent=(cd--)+"s"; if(cd<0) cd=18; },1000);

/* ===== ConexÃ£o (WS + HTTP via proxy) ===== */
(function restore(){ const s=localStorage.getItem("sc.url"); if(s) $("#srcUrl").value=s; })();
$("#btnConnect").onclick=()=>{ const url=$("#srcUrl").value.trim(); if(!url) return log("URL vazia"); localStorage.setItem("sc.url",url); start(url); };
let sock=null, poll=null;
function start(url){
  if(sock){ try{sock.close()}catch{} sock=null; }
  if(poll){ clearInterval(poll); poll=null; }
  if(/^wss?:/i.test(url)){ netMode.textContent="WS"; tryWS(url, ()=>tryHTTP(toHTTP(url))); }
  else { tryHTTP(url); }
}
function toHTTP(u){ return u.replace(/^wss:/,'https:').replace(/^ws:/,'http:'); }
function tryWS(url){
  setStatus("Conectando WS...");
  try{
    sock=new WebSocket(url);
    sock.onopen=()=>{ setStatus("Conectado (WS)",true); netMode.textContent="WS"; log("WS conectado"); };
    sock.onerror=()=>{ setStatus("Erro WS"); log("WS erro"); };
    sock.onclose=()=>{ setStatus("WS fechado"); log("WS fechado â€” fallback HTTP"); tryHTTP(toHTTP(url)); };
    sock.onmessage=(e)=>handleRaw(e.data);
  }catch(e){ setStatus("Falha WS"); log("WS falha: "+e.message); tryHTTP(toHTTP(url)); }
}
function tryHTTP(url){
  netMode.textContent="HTTP (via proxy)"; setStatus("Conectado (HTTP)",true);
  const tick=async()=>{
    try{
      const r=await fetch(`/api/proxy?url=${encodeURIComponent(url)}`,{cache:'no-store'});
      let j={}; try{ j=await r.json(); }catch{ return log("JSON incompleto"); }
      const num=j?.content?.[0]?.data?.result?.[0]?.number ?? j?.data?.result?.[0]?.number;
      if(Number.isFinite(num)) onNumber(num,"HTTP");
    }catch(e){ setStatus("Erro HTTP"); log("HTTP erro: "+e.message); }
  };
  tick(); poll=setInterval(tick,3000);
}
function handleRaw(raw){
  let j=null; try{ j=JSON.parse(typeof raw==="string"?raw:String(raw)); }catch{}
  let n=null;
  if(j?.type==="roulette.winSpots") n=j?.args?.result?.[0]?.number;
  else if(j?.winningNumber) n=j.winningNumber;
  if(Number.isFinite(n)) onNumber(n,"WS");
}

/* ===== EstratÃ©gias (motor) ===== */
const wheelMod=(x)=>((x%37)+37)%37;
const freq=(arr)=>arr.reduce((m,a)=>(m[a]=(m[a]||0)+1,m),{});
const leastSeen=(arr)=>{ const f=freq(arr); let best=null, v=1e9; for(let i=0;i<=36;i++){ const c=f[i]||0; if(c<v){v=c; best=i;} } return best; };
const lastN=(arr,n)=>arr.slice(-n);

const fireMap={0:[26,32,15,3,19],1:[33,20,14,31,9],2:[17,25,21,4,15],3:[26,35,0,12,19],4:[19,21,36,16,2],5:[10,24,30,33,27],6:[34,9,29,17,11],7:[28,18,22,13,29],8:[30,23,10,11,23],9:[31,22,33,18,6]};
function firePrecision(u){ return (fireMap[u]||terminals(u)).slice(0,5); }

function vizinho(u,k){ return [wheelMod(u-k),wheelMod(u),wheelMod(u+k)]; }
function terminals(u){ const d=u%10; const out=[]; for(let i=d;i<=36;i+=10) out.push(i); return out; }
function terminalsV4(hist){ const a=hist.at(-1)||0, b=hist.at(-2)||null; const s=new Set(terminals(a)); if(b!=null) terminals(b).forEach(n=>s.add(n)); return [...s]; }
function terminalsDuplos(hist){ const a=hist.at(-1)||0, b=hist.at(-2)||0; const s=new Set([...terminals(a),...terminals(b)]); return [...s]; }
function finais(hist){ const a=hist.at(-1)||0, b=hist.at(-2)||0, c=hist.at(-3)||0; const s=new Set([...terminals(a),...terminals(b),...terminals(c)]); return [...s]; }
function finaisProgressivos(hist){ const arr=[...new Set(hist.slice(-6).map(x=>x%10))]; const s=new Set(); arr.forEach(d=>{ for(let i=d;i<=36;i+=10) s.add(i); }); return [...s]; }
function tiroSeco(u){ return [u]; }
function formula5X(u){ return Array.from(new Set([wheelMod(u-2),wheelMod(u-1),u,wheelMod(u+1),wheelMod(u+2)]) ); }
function alpha6(u){ return Array.from(new Set([...formula5X(u), wheelMod(u+3)]) ); }
function linhaFinais(hist){ return finais(hist).filter(n=>n!==0); }
function quartaDim(hist){ // mistura: Ãºltimo, menos frequente e vizinhos
  const u=hist.at(-1)||0; return Array.from(new Set([u,leastSeen(hist),...vizinho(u,1),...vizinho(u,2)])).slice(0,10);
}
function patternBreaker(hist){ // escolhe nÃºmeros menos vistos na janela
  const f=freq(hist.slice(-24)); const arr=[...Array(37).keys()].sort((a,b)=>(f[a]||0)-(f[b]||0)); return arr.slice(0,10);
}
function cavaloSet(nums){ return nums.filter(n=>n>=0&&n<=36); }
function cavalo147(){ return cavaloSet([1,4,7,10,13,16,19,22,25,28,31,34]); }
function cavalo258(){ return cavaloSet([2,5,8,11,14,17,20,23,26,29,32,35]); }
function cavalo369(){ return cavaloSet([3,6,9,12,15,18,21,24,27,30,33,36]); }
function cavaloSCpremium(u){ return Array.from(new Set([...vizinho(u,1),...terminals(u),leastSeen(history)])); }
function sectorTarget(u){ // 12 nÃºmeros ao redor (3 sectores)
  return Array.from(new Set([wheelMod(u-6),wheelMod(u-5),wheelMod(u-4),wheelMod(u-3),wheelMod(u-2),wheelMod(u-1),u,wheelMod(u+1),wheelMod(u+2),wheelMod(u+3),wheelMod(u+4),wheelMod(u+5)]));
}
function iaTop5(hist){ const win=hist.slice(-50); const f=freq(win); return [...Array(37).keys()].sort((a,b)=>(f[a]||0)-(f[b]||0)).slice(0,5); }
function iaSecret(hist){ // alternÃ¢ncia par/Ã­mpar & cor
  const u=hist.at(-1)||0; const alt = (hist.at(-1)||0)%2!== (hist.at(-2)||0)%2;
  const base = alt ? patternBreaker(hist) : iaTop5(hist);
  return Array.from(new Set([ ...base.slice(0,5), ...vizinho(u,1) ])).slice(0,10);
}

const engines={
  "Fire Precision": (h)=>firePrecision(h.at(-1)||0),
  "CaÃ§ador de RepetiÃ§Ãµes": (h)=>{ const u=h.at(-1)||0; const d=h.slice(-12).filter(x=>x===u).length; return d>=2 ? [u] : vizinho(u,1); },
  "Vizinho 1": (h)=>vizinho(h.at(-1)||0,1),
  "Vizinho 2": (h)=>vizinho(h.at(-1)||0,2),
  "Vizinho 3": (h)=>vizinho(h.at(-1)||0,3),
  "Terminais v4": terminalsV4,
  "Terminais Secretos": (h)=>finaisProgressivos(h).slice(0,10),
  "Terminais Duplos": terminalsDuplos,
  "Terminais dos Finais": finais,
  "Terminais Progressivos": finaisProgressivos,
  "Tiro Seco": (h)=>tiroSeco(h.at(-1)||0),
  "FÃ³rmula 5X": (h)=>formula5X(h.at(-1)||0),
  "Alpha 6": (h)=>alpha6(h.at(-1)||0),
  "Linha dos Finais": linhaFinais,
  "Quarta DimensÃ£o": quartaDim,
  "Pattern Breaker": patternBreaker,
  "Cavalo SC Premium": (h)=>cavaloSCpremium(h.at(-1)||0),
  "Cavalo 147": ()=>cavalo147(),
  "Cavalo 258": ()=>cavalo258(),
  "Cavalo 369": ()=>cavalo369(),
  "Sector Target": (h)=>sectorTarget(h.at(-1)||0),
  "IA Top 5": iaTop5,
  "IA Secret Pattern": iaSecret
};

/* ===== Estado / histÃ³rico ===== */
let history=[];
function onNumber(n,mode){
  history.push(n); if(history.length>60) history.shift();
  ultimoEl.textContent=String(n);
  const estr=$("#estrategia").value;
  const alvos = (engines[estr]||(()=>[]))(history).filter(x=>x>=0 && x<=36);
  const conf = Math.min(95, Math.round((alvos.length/12)*100));
  paint(n, new Set(alvos));
  cap.textContent=`Ãšltimo: ${n} â€¢ ConfianÃ§a: ${conf}% â€¢ Top5: ${alvos.slice(0,5).join(", ")||"â€”"}`;
  flash(conf);

  const auto = $("#autosend").value==="true";
  if(auto) enviarTG(estr, alvos, conf);
}

/* ===== Envio TG / API ===== */
async function enviarTG(estrategia, alvos, conf){
  try{
    const body = {
      history,
      roulette: "Immersive",
      estrategia,
      alvos,
      minconf: Number($("#minconf").value)||0,
      auto_send: true
    };
    const r = await fetch("/api/suggest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)});
    const j = await r.json();
    log(`CALL enviada â€¢ ${estrategia} â€¢ alvo(s): ${alvos.join(", ")||"â€”"} â€¢ resp: ${j?.ok||"ok"}`);
  }catch(e){ log("Falha /api/suggest: "+e.message); }
}
$("#btnTG").onclick=()=>{ const estr=$("#estrategia").value; const alvos=(engines[estr]||(()=>[]))(history); enviarTG(estr,alvos,Number($("#minconf").value)||0); };

/* ===== PersistÃªncia de UI ===== */
(function(){
  const sE=localStorage.getItem("sc.estr"); if(sE) $("#estrategia").value=sE;
  const sA=localStorage.getItem("sc.auto"); if(sA) $("#autosend").value=sA;
  const sM=localStorage.getItem("sc.min"); if(sM) $("#minconf").value=sM;
})();
$("#estrategia").onchange=()=>localStorage.setItem("sc.estr", $("#estrategia").value);
$("#autosend").onchange =()=>localStorage.setItem("sc.auto", $("#autosend").value);
$("#minconf").oninput  =()=>localStorage.setItem("sc.min", $("#minconf").value);
</script>
</body>
</html>
